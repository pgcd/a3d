{% load board_tags faves %}
{% prefetch tags for post_list %}
{% prefetch post_interactions for post_list %}
{% inject_faves_to post_list by request.user of type star as is_starred %}

{% if more_down %}
	<a href="{{parent_post.get_replies_url}}?start=-{{more_down}}" class="endless-paginator" rel="prev" data-attach-method="prepend">previous</a>
{% endif %}


{% if post_list|length %}
	{% with post_list|last as l %}
	<ol id="replies-{{parent_post.pk}}"
		class="replies-list new-content"
		data-next-item="{{l.pk|add:'1'}}"
		data-source-href="{{parent_post.get_replies_url}}?start={{l.pk|add:'1'}}"
		data-items-left="{{items_left}}" 
		data-content-update-interval="120">
	{% endwith %}
{% else %}
	<ol id="replies-{{parent_post.pk}}" class="replies-list new-content" data-items-left="0" data-source-href="{{parent_post.get_replies_url}}">
{% endif %}
	<style type="text/css" scoped="scoped">
		{% prefetch profiles for post_list as user_profiles %}
		{% for pp in user_profiles %}
			{% if pp.custom_nick_display %}
			a.user-id-{{pp.user_id}} {
				{{pp.custom_nick_display|safe|escapecss }}
			}
			{% endif %}
		{% endfor %}
	</style>
	{% for post in post_list  %}
	{% block reply_body %}
		{% include "board/post_body.html" %}
	{% endblock %}
	{% endfor %}
</ol>
{% if more_up %}
	<a href="{{parent_post.get_replies_url}}?start={{more_up}}" class="endless-paginator" rel="next" data-attach-method="append" data-items-left="{{items_left}}">{{items_left}} more</a>
{% endif %}
